-- Crear base de datos TecnoAcademia
CREATE DATABASE IF NOT EXISTS tecnoacademia 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

USE tecnoacademia;

-- Tabla de profesoras
CREATE TABLE profesoras (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    hashed_password VARCHAR(255) NOT NULL,
    especialidad VARCHAR(100) NOT NULL,
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    activa BOOLEAN DEFAULT TRUE,
    
    INDEX idx_email (email),
    INDEX idx_activa (activa)
) ENGINE=InnoDB;

-- Tabla de asistencias
CREATE TABLE asistencias (
    id INT AUTO_INCREMENT PRIMARY KEY,
    profesora_id INT NOT NULL,
    fecha DATETIME NOT NULL,
    presente BOOLEAN NOT NULL,
    observaciones TEXT,
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (profesora_id) REFERENCES profesoras(id) ON DELETE CASCADE,
    INDEX idx_profesora_fecha (profesora_id, fecha),
    INDEX idx_fecha (fecha),
    INDEX idx_presente (presente)
) ENGINE=InnoDB;

-- Tabla de clases
CREATE TABLE clases (
    id INT AUTO_INCREMENT PRIMARY KEY,
    profesora_id INT NOT NULL,
    titulo VARCHAR(200) NOT NULL,
    fecha_inicio DATETIME NOT NULL,
    fecha_fin DATETIME NOT NULL,
    ubicacion VARCHAR(100) NOT NULL COMMENT 'Colegio o Centro TecnoAcademia',
    descripcion TEXT,
    fecha_creacion DATETIME DEFAULT CURRENT_TIMESTAMP,
    activa BOOLEAN DEFAULT TRUE,
    
    FOREIGN KEY (profesora_id) REFERENCES profesoras(id) ON DELETE CASCADE,
    INDEX idx_profesora_fecha (profesora_id, fecha_inicio),
    INDEX idx_fecha_inicio (fecha_inicio),
    INDEX idx_ubicacion (ubicacion),
    INDEX idx_activa (activa),
    
    CHECK (fecha_fin > fecha_inicio),
    CHECK (ubicacion IN ('Colegio', 'Centro TecnoAcademia'))
) ENGINE=InnoDB;